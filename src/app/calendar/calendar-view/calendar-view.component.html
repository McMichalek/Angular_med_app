<div class="calendar-container">
  <div class="calendar-header">
    <!-- Nawigacja tygodniowa: poprzedni tydzień, obecny, następny -->
    <button (click)="prevWeek()">« Poprzedni tydzień</button>
    <button (click)="goToCurrentWeek()">Obecny tydzień</button>
    <button (click)="nextWeek()">Następny tydzień »</button>

    <!-- Nowe przyciski: przewijanie godzin w górę / w dół -->
    <button (click)="scrollUp()">Godziny ↑</button>
    <button (click)="scrollDown()">Godziny ↓</button>
  </div>

  <table class="calendar-table">
    <thead>
    <tr>
      <!-- Pusta komórka w nagłówku dla kolumny godzin -->
      <th></th>
      <!-- Nagłówki kolumn - 7 dni tygodnia -->
      <th *ngFor="let day of displayedDays"
          [class.today]="isToday(day)"
          [class.absent]="isDayInAbsence(day)">
        <div>{{ day.format('dddd') }}, {{ day.format('DD.MM') }}</div>
        <div class="appointments-count">
          <!-- Liczba rezerwacji zarejestrowanych na dany dzień -->
          Rezerwacje: {{ getAppointmentsCountForDay(day) }}
        </div>
      </th>
    </tr>
    </thead>
    <tbody>
    <!-- Wiersze: sloty co 30 min -->
    <tr *ngFor="let slot of timeSlots">
      <!-- Komórka z godziną (nagłówek wiersza) -->
      <th class="time-label">{{ formatHour(slot) }}</th>

      <!-- Kolumny dla 7 dni w tygodniu -->
      <td *ngFor="let day of displayedDays"
          [class.today]="isToday(day)"
          [class.current-time]="isCurrentTimeSlot(slot, day)"
          [class.unavailable]="!isSlotAvailable(day, slot) || isDayInAbsence(day)"
          [class.absent]="isDayInAbsence(day)"
      >
        <ng-container *ngIf="isSlotAvailable(day, slot); else unavailableSlot">
          <!-- Pokazujemy rezerwacje (może być 0 lub wiele) -->
          <ng-container *ngFor="let appt of getAppointmentsForSlot(day, slot)">
            <div class="appointment-block"
                 [class.past]="isPastAppointment(appt)"
                 [title]="
                     'Typ: ' + appt.type + '\n' +
                     'Pacjent: ' + appt.patientName + '\n' +
                     'Godz.: ' +
                       (appt.startTime | date:'HH:mm') + ' - ' +
                       (appt.endTime   | date:'HH:mm')
                   ">
              {{ appt.type }} ({{ appt.patientName }})
            </div>
          </ng-container>

          <!-- Jeśli brak rezerwacji, a slot jest dostępny, pokaż 'Wolny' -->
          <div *ngIf="getAppointmentsForSlot(day, slot).length === 0" class="slot-free">
            Wolny
          </div>
        </ng-container>

        <!-- Gdy slot niedostępny (nieobjęty żadną dostępnością lekarza) -->
        <ng-template #unavailableSlot>
          <div class="slot-unavailable">Niedostępne</div>
        </ng-template>
      </td>
    </tr>
    </tbody>
  </table>
</div>
