<div class="calendar-container">
  <div class="calendar-header">
    <!-- Nawigacja tygodniowa: poprzedni tydzień, obecny, następny -->
    <button (click)="prevWeek()">« Poprzedni tydzień</button>
    <button (click)="goToCurrentWeek()">Obecny tydzień</button>
    <button (click)="nextWeek()">Następny tydzień »</button>

    <!-- Nowe przyciski: przewijanie godzin w górę / w dół -->
    <button (click)="scrollUp()">Godziny ↑</button>
    <button (click)="scrollDown()">Godziny ↓</button>
  </div>

  <table class="calendar-table">
    <thead>
    <!-- Nagłówki kolumn z dniami -->
    <tr>
      <th></th> <!-- kolumna godzin -->
      <th *ngFor="let day of displayedDays">
        {{ day.format('dddd') }} ({{ day.format('DD.MM') }})
      </th>
    </tr>
    </thead>

    <tbody>
    <!-- Wiersze = sloty czasowe co 30 min -->
    <tr *ngFor="let slot of timeSlots">
      <!-- Komórka z godziną -->
      <th class="time-label">{{ formatHour(slot) }}</th>

      <!-- Komórki: poszczególne dni w tygodniu -->
      <td *ngFor="let day of displayedDays"
          [class.absent]="isDayInAbsence(day)">

        <!-- 1) Jeśli ten dzień jest w absencji => wyświetl 'Absencja' -->
        <ng-container *ngIf="!isDayInAbsence(day); else absentDay">

          <!-- 2) Dzień nie jest w absencji => sprawdź rezerwacje w tym slocie -->
          <ng-container *ngIf="getAppointmentsForSlot(day, slot).length > 0; else noAppointment">

            <!-- 2a) Istnieje rezerwacja => wyświetl typ konsultacji -->
            <ng-container *ngFor="let appt of getAppointmentsForSlot(day, slot)">
              <div class="appointment-block">
                {{ appt.type }}
              </div>
            </ng-container>

          </ng-container>
          <!-- 2b) Brak rezerwacji => czy slot jest dostępny? -->
          <ng-template #noAppointment>
            <ng-container *ngIf="isSlotAvailable(day, slot); else notAvailable">
              <div class="slot-free">Wolny</div>
            </ng-container>
            <!-- Domyślnie (jeśli nie 'isSlotAvailable') => Niedostępne -->
            <ng-template #notAvailable>
              <div class="slot-unavailable">Niedostępne</div>
            </ng-template>
          </ng-template>

        </ng-container>
        <!-- 1b) Szablon, gdy dzień jest w absencji -->
        <ng-template #absentDay>
          <div class="slot-absent">Absencja</div>
        </ng-template>
      </td>
    </tr>
    </tbody>
  </table>
</div>
